---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import NewsCard from '../components/NewsCard.astro';
import CallToAction from '../components/CallToAction.astro';
import { getCollection } from 'astro:content';

const products = await getCollection('products', (p) => p.data.published);
const featuredProducts = products
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 6);
const latestProducts = products
  .sort((a, b) => (b.data.updatedAt?.getTime() ?? 0) - (a.data.updatedAt?.getTime() ?? 0))
  .slice(0, 6);
const displayProducts = featuredProducts.length >= 3 ? featuredProducts : latestProducts;

const news = await getCollection('news', (n) => n.data.published);
const latestNews = news
  .sort((a, b) => b.data.publishedDate.getTime() - a.data.publishedDate.getTime())
  .slice(0, 3);
---

<BaseLayout title="" description="Eakiet Coffee — Cà phê gia đình. Sản phẩm chất lượng cao, thông tin và liên hệ.">
  <section class="relative overflow-hidden bg-gradient-to-b from-coffee-800 to-coffee-900 px-4 py-20 text-white sm:px-6 sm:py-28 lg:px-8">
    <div class="mx-auto max-w-4xl text-center">
      <h1 class="text-4xl font-bold tracking-tight sm:text-5xl lg:text-6xl">Eakiet Coffee</h1>
      <p class="mt-4 text-lg text-coffee-200 sm:text-xl">
        Cà phê gia đình — Chất lượng cao, thông tin rõ ràng. Khám phá sản phẩm và liên hệ với chúng tôi.
      </p>
      <div class="mt-8">
        <CallToAction href="/products" text="Xem sản phẩm" variant="secondary" />
        <span class="mx-3 inline-block text-coffee-300">hoặc</span>
        <CallToAction href="/contact" text="Liên hệ" variant="primary" />
      </div>
    </div>
  </section>

  {displayProducts.length > 0 && (
    <section class="mx-auto max-w-6xl px-4 py-16 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-bold text-coffee-900 sm:text-3xl">Sản phẩm nổi bật</h2>
      <p class="mt-2 text-coffee-600">Khám phá các dòng cà phê chất lượng của chúng tôi.</p>
      <div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {displayProducts.map((product) => (
          <ProductCard
            title={product.data.title}
            price={product.data.price}
            currency={product.data.currency}
            image={product.data.mainImage}
            slug={product.slug}
            category={product.data.category}
            description={product.data.description}
          />
        ))}
      </div>
      <div class="mt-10 text-center">
        <CallToAction href="/products" text="Xem tất cả sản phẩm" variant="secondary" />
      </div>
    </section>
  )}

  {latestNews.length > 0 && (
    <section class="border-t border-coffee-200 bg-coffee-100/30">
      <div class="mx-auto max-w-6xl px-4 py-16 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-coffee-900 sm:text-3xl">Tin tức mới</h2>
        <p class="mt-2 text-coffee-600">Cập nhật từ Eakiet Coffee.</p>
        <div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {latestNews.map((article) => (
            <NewsCard
              title={article.data.title}
              excerpt={article.data.excerpt}
              image={article.data.featuredImage}
              slug={article.slug}
              date={article.data.publishedDate}
            />
          ))}
        </div>
        <div class="mt-10 text-center">
          <CallToAction href="/news" text="Xem tất cả tin tức" variant="secondary" />
        </div>
      </div>
    </section>
  )}

  <section class="mx-auto max-w-6xl px-4 py-16 sm:px-6 lg:px-8">
    <div class="rounded-2xl bg-coffee-800 px-6 py-12 text-center text-white sm:py-16">
      <h2 class="text-2xl font-bold sm:text-3xl">Bạn cần tư vấn hoặc đặt hàng?</h2>
      <p class="mt-3 text-coffee-200">Liên hệ với chúng tôi qua điện thoại hoặc email.</p>
      <div class="mt-8">
        <CallToAction href="/contact" text="Liên hệ ngay" variant="secondary" />
      </div>
    </div>
  </section>
</BaseLayout>
